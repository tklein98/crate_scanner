<!DOCTYPE html>

<html lang="en", style="display:flex;">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename= 'css/index.css') }}"> -->
    <title>Crate Scanner</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@100;300;400;600;700&display=swap" rel="stylesheet">
    <style>
      body {
          background-color: black;
          color: white;
        }
      div.containerresult {
            font-family: 'Roboto Mono';
            display: flex;
            flex-direction: column;
            margin: 4vh;
          }

      div.album-profile {
        display: flex;
      }

      div.reviews {
        width: 80%;
        font-size: 1em;
      }

      button {
        border-radius: 50px;
        background-color: #E8A000;
        font-size: 16px;
        margin-top: 50px;
        font-family: 'Roboto Mono';
        width: 35vh;
        color: white;
        padding: 10px 20px;
      }

      div.center {
        display: flex;
        justify-content: center;
      }

      #spinner-overlay {
        background-color: black;
        z-index: 999;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

   </style>
  </head>
  <body>
    <div id="spinner-overlay" >
      <img style="width: 100%" src="{{url_for('static',filename = 'vinyl.gif')}}" >
    </div>
    <div class="containerresult" id="contents">
      <div class="album-profile">
        <div style="margin-left: 10px;">
          <h1 id="artist" style= "font-size: 20px; font-weight: bold; margin: 0px;">placeholder Artist</h1>
          <h3 id="album" style= "font-size: 15px; font-weight: normal;">placeholder Artist</h3>
          <p id="price" style= "font-size: 15px; font-weight: lighter;">placeholder Artis</p>
        </div>
      </div>
      <div id="spotify-widget">
         <p style= "font-size: 20px; font-weight: normal;">Listen to some songs</p>
      </div>
      <div class="reviews">
        <p style= "font-size: 20px;">Reviews</p>
        <div class="reviews-wrapper"></div>
      </div>
      <div class="center"><button href="/">Scan another Vinyl</button></div>


    </div>

    <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>

  <script>
        console.log("api call dispatched");
        jQuery.ajax({
        method: 'GET',
        url: '/album-api/?url={{url}}',
        error: function (xhr, status, err) {
          console.log("api error");

          ajaxBusy = false;
        },
        success: function (res) {
          console.log("api success")
          console.log(res);

          ajaxBusy = false;

          populateData(res);
        }});
      </script>

      <script>
        function populateData(res) {

          // populate album info
          jQuery('#artist').html(res.artist);
          jQuery('#album').html(res.album);
          jQuery('#price').html(res.price + " â‚¬");

          // Insert album art at beginning of .album-profile
          jQuery('.album-profile').prepend('<image src="' + res.cover_url + '" width="150" height="150">');

          // populate album reviews
          if(res.reviews.length === 0) {
            jQuery('.album-profile').prepend('<p style="font-weight: lighter; font-size: 14px">' + 'No reviews found.' + '</p>');
          }

          for(var i in res.reviews) {
            var reviewText = res.reviews[i];

            jQuery('.reviews-wrapper').prepend('<p style="font-weight: lighter; font-size: 14px">' + reviewText + '</p>');

          }

          // Spotify widdget
          jQuery('#spotify-widget').append('<iframe src="https://open.spotify.com/embed/album/' + res.album_id + '" height="400" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>');

          // Hide Spinner overlay once data is loaded
          jQuery('#spinner-overlay').fadeOut();
        }

      </script>
  </body>

</html>



